{% extends "base.html" %}

{% block title %}Flavor Profile - Deconstructionist Cookbook{% endblock %}

{% block content %}
<div class="flavor-profile-container">
    <div class="row mb-5">
        <div class="col-md-8 offset-md-2 text-center" data-aos="fade-up">
            <h2 class="mb-4">Your Flavor Profile</h2>
            <p class="lead">Explore the dimensions of your culinary identity based on the ingredients you use.</p>
            <div class="tech-decoration">
                <div class="circle-pulse"></div>
                <div class="horizontal-line"></div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-12 text-center" data-aos="fade-up" data-aos-delay="100">
            <div class="ingredients-summary">
                <h4>Based on your ingredients:</h4>
                <div class="ingredient-tags">
                    {% for ingredient in user_ingredients %}
                    <span class="ingredient-tag">{{ ingredient }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-5" data-aos="fade-up" data-aos-delay="150">
            <div class="flavor-message-card">
                <div class="pattern-overlay"></div>
                <div class="flavor-message-content">
                    <h3 class="mb-4"><i class="fas fa-comment-alt"></i> Your Flavor Story</h3>
                    <div class="flavor-message">
                        <p>{{ flavor_message }}</p>
                    </div>
                    <div class="dominant-cuisine">
                        <h4>Dominant Culinary Heritage</h4>
                        <div class="cuisine-badge">{{ dominant_cuisine }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-5" data-aos="fade-up" data-aos-delay="200">
            <div class="explanation-card">
                <div class="pattern-overlay"></div>
                <div class="explanation-content">
                    <h3 class="mb-4"><i class="fas fa-info-circle"></i> Understanding Your Profile</h3>
                    <p>Your flavor profile is generated by analyzing the ingredients you've entered and mapping them to flavor categories based on culinary science research.</p>
                    <p>Each ingredient contributes to different flavor dimensions like <strong>Savory</strong>, <strong>Sweet</strong>, <strong>Spicy</strong>, <strong>Herbaceous</strong>, and <strong>Umami</strong>.</p>
                    <p>This profile is a computational way of understanding your cooking preferences, but remember that food identity is complex and goes beyond simple classifications.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-12" data-aos="fade-up" data-aos-delay="250">
            <div class="chart-card">
                <div class="pattern-overlay"></div>
                <div class="chart-content">
                    <h3 class="chart-title mb-4"><i class="fas fa-chart-radar"></i> Flavor Dimensions</h3>
                    <p class="chart-description">This radar chart maps your flavor profile across five key dimensions, showing your culinary preferences at a glance.</p>
                    <div id="flavor-radar" class="chart-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-12" data-aos="fade-up" data-aos-delay="300">
            <div class="chart-card">
                <div class="pattern-overlay"></div>
                <div class="chart-content">
                    <h3 class="chart-title mb-4"><i class="fas fa-sitemap"></i> Culinary Heritage Map</h3>
                    <p class="chart-description">This tree map visualizes the cultural influences in your ingredient choices, highlighting how different culinary traditions have shaped your food identity.</p>
                    <div id="heritage-tree" class="chart-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-12 text-center" data-aos="fade-up" data-aos-delay="350">
            <div class="buttons-container">
                <a href="{{ url_for('results', ingredients=','.join(user_ingredients)) }}" class="btn btn-primary btn-lg interactive-button">
                    <span class="button-icon"><i class="fas fa-arrow-left"></i></span>
                    <span class="button-text">Back to Results</span>
                </a>
                <a href="{{ url_for('cookbook') }}" class="btn btn-outline-primary btn-lg interactive-button">
                    <span class="button-icon"><i class="fas fa-book"></i></span>
                    <span class="button-text">New Ingredients</span>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block head %}
<style>
    .flavor-profile-container {
        padding: 2rem 0 4rem;
    }
    
    .tech-decoration {
        position: relative;
        height: 60px;
        width: 100%;
        margin: 2rem auto;
    }
    
    .circle-pulse {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: var(--vibrant-color);
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
        box-shadow: 0 0 0 rgba(255, 107, 107, 0.4);
        animation: enhancedPulse 2s infinite;
    }
    
    .horizontal-line {
        position: absolute;
        height: 2px;
        width: 60%;
        background: linear-gradient(90deg, transparent, var(--vibrant-color), transparent);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    
    .ingredients-summary {
        margin-bottom: 30px;
    }
    
    .ingredient-tags {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
    }
    
    .ingredient-tag {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, var(--vibrant-gradient-start), var(--vibrant-gradient-end));
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.95rem;
        box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        animation: float 6s ease-in-out infinite;
        animation-delay: calc(var(--animation-delay, 0) * 0.5s);
    }
    
    .flavor-message-card, .explanation-card, .chart-card {
        position: relative;
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-vibrant);
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%;
    }
    
    .flavor-message-card:hover, .explanation-card:hover, .chart-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(255, 107, 107, 0.3);
    }
    
    .pattern-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            linear-gradient(30deg, rgba(255, 107, 107, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 107, 107, 0.05) 87.5%, rgba(255, 107, 107, 0.05)),
            linear-gradient(150deg, rgba(255, 107, 107, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 107, 107, 0.05) 87.5%, rgba(255, 107, 107, 0.05));
        background-size: 40px 40px;
        opacity: 0.3;
        z-index: 0;
        animation: patternShift 20s linear infinite;
    }
    
    .flavor-message-content, .explanation-content, .chart-content {
        position: relative;
        z-index: 1;
        padding: 2.5rem;
    }
    
    .flavor-message {
        background-color: rgba(255, 248, 248, 0.7);
        border-radius: var(--border-radius-sm);
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid var(--vibrant-color);
        font-size: 1.1rem;
        line-height: 1.6;
    }
    
    .dominant-cuisine {
        text-align: center;
        margin-top: 30px;
    }
    
    .cuisine-badge {
        display: inline-block;
        background: linear-gradient(135deg, var(--vibrant-gradient-start), var(--vibrant-gradient-end));
        color: white;
        padding: 10px 25px;
        border-radius: 30px;
        font-size: 1.2rem;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        animation: pulse 2s infinite;
    }
    
    .chart-title {
        text-align: center;
        color: var(--vibrant-color);
    }
    
    .chart-description {
        text-align: center;
        margin-bottom: 30px;
        color: #666;
    }
    
    .chart-container {
        width: 100%;
        height: 400px;
        margin: 0 auto;
    }
    
    .buttons-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
    }
    
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
        70% { box-shadow: 0 0 0 15px rgba(255, 107, 107, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
    }
    
    @keyframes patternShift {
        0% { background-position: 0% 0%; }
        100% { background-position: 100% 100%; }
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set animation delay for ingredient tags
        const ingredientTags = document.querySelectorAll('.ingredient-tag');
        ingredientTags.forEach((tag, index) => {
            tag.style.setProperty('--animation-delay', index);
        });
        
        // Initialize the radar chart
        const radarData = {{ graphJSON_radar | safe }};
        Plotly.newPlot('flavor-radar', radarData.data, radarData.layout, {
            responsive: true,
            displayModeBar: false
        });
        
        // Initialize the heritage tree map
        const heritageData = {{ graphJSON_heritage | safe }};
        Plotly.newPlot('heritage-tree', heritageData.data, heritageData.layout, {
            responsive: true,
            displayModeBar: false
        });
    });
</script>
{% endblock %} 